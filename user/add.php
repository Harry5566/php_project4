<?php
// add.php - Êñ∞Â¢ûÊúÉÂì°Ë°®ÂñÆ
require_once "./connect.php";

// ÂèñÂæóÊÄßÂà•ÈÅ∏È†Ö
$genderSql = "SELECT * FROM `genders` ORDER BY id ASC";
$genderStmt = $pdo->prepare($genderSql);
$genderStmt->execute();
$genders = $genderStmt->fetchAll(PDO::FETCH_ASSOC);

// ÂèñÂæóÊúÉÂì°Á≠âÁ¥öÈÅ∏È†Ö
$levelSql = "SELECT * FROM `member_level` ORDER BY id ASC";
$levelStmt = $pdo->prepare($levelSql);
$levelStmt->execute();
$levels = $levelStmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!doctype html>
<html lang="en" class="layout-wide customizer-hide" data-assets-path="../assets/"
  data-template="vertical-menu-template-free">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>Êñ∞Â¢ûÊúÉÂì° - Xin Ch√†oÂøÉÊ©ã</title>

  <meta name="description" content="" />

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon/vnlogo-ic.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="../assets/vendor/fonts/iconify-icons.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="../assets/vendor/css/core.css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />

  <!-- Page CSS -->
  <link rel="stylesheet" href="../assets/vendor/css/pages/page-auth.css" />

  <!-- custom.css -->
  <link rel="stylesheet" href="./css/custom.css">

  <style>
    body {
      background-image: url("./img/vie.webp");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
    }

    .authentication-wrapper {
      backdrop-filter: blur(2px);
      background: rgba(0, 0, 0, 0.1);
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 0 auto;
    }

    .color-vip {
      background-color: color-mix(in srgb, #fff 84%, #03c3ec) !important;
      color: #03c3ec !important;
    }

    .placeholder-color::placeholder {
      font-weight: bold;
      color: #888;
      opacity: 1;
    }

    .form-row {
      display: flex;
      gap: 1rem;
    }

    .form-row .form-group {
      flex: 1;
    }

    .gender-options {
      display: flex;
      gap: 2rem;
      margin-top: 0.5rem;
    }

    .file-preview {
      max-width: 250px;
      max-height: 250px;
      object-fit: cover;
      border: 3px solid #e8491d;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .upload-area {
      border: 2px dashed #d4d4d8;
      border-radius: 0.375rem;
      background-color: rgba(250, 250, 250, 0.8);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.5s;
    }

    .upload-area:hover {
      border-color: #ae431e;
      background-color: rgba(141, 52, 25, 0.2);
    }

    .logo {
      max-height: 180px;
      width: auto;
      display: block;
    }
  </style>

  <script src="../assets/vendor/js/helpers.js"></script>
  <script src="../assets/js/config.js"></script>
</head>

<body>
  <!-- Content -->
  <div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
      <div class="authentication-inner">
        <!-- Register Card -->
        <div class="card px-6 py-5">
          <div class="card-body">
            <!-- Logo -->
            <div class="app-brand justify-content-center mb-4">
              <a href="./login.php" class="app-brand-link gap-2">
                <span>
                  <span><img class="logo" src="../assets/img/favicon/logo-main.png" alt=""></span>
                </span>
                <!-- <span class="fs-4 fw-bold ms-2 demo text-heading">ÂøÉÊ©ã</span> -->
              </a>
            </div>

            <div class="text-center mb-4">
              <h5 class="text-primary">
                <i class="fas fa-user-plus me-2"></i>Êñ∞Â¢ûÊúÉÂì°
              </h5>
              <p class="text-muted">Ê≠°ËøéÂä†ÂÖ•ÂøÉÊ©ãÊóÖÈÅäÂ§ßÂÆ∂Â∫≠ÔºÅüåü</p>
            </div>

            <form id="memberForm" class="mb-4" action="./doAdd.php" method="post" enctype="multipart/form-data">

              <!-- Â∏≥ËôüËàáÂØÜÁ¢º -->
              <div class="form-row mb-3">
                <div class="form-group">
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="text" class="form-control placeholder-color" id="account" name="account"
                      placeholder="Â∏≥Ëôü *" required autofocus />
                  </div>
                </div>
                <div class="form-group">
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" id="password" class="form-control placeholder-color" name="password"
                      placeholder="ÂØÜÁ¢º * (5-20Â≠óÂÖÉ)" minlength="5" maxlength="20" required />
                  </div>
                </div>
              </div>

              <!-- ÂßìÂêç -->
              <div class="input-group mb-3">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                <input type="text" class="form-control placeholder-color" id="name" name="name" placeholder="ÂßìÂêç *"
                  required />
              </div>

              <!-- Email ÂíåÈõªË©± -->
              <div class="form-row mb-3">
                <div class="form-group">
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                    <input type="email" class="form-control placeholder-color" id="email" name="email"
                      placeholder="Email *" required />
                  </div>
                </div>
                <div class="form-group">
                  <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                    <input type="tel" class="form-control placeholder-color" id="phone" name="phone"
                      placeholder="ÈõªË©±ËôüÁ¢º *" required />
                  </div>
                </div>
              </div>

              <!-- ÁîüÊó• -->
              <div class="input-group mb-3">
                <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                <input type="date" class="form-control" id="birth_date" name="birth_date" required />
              </div>

              <!-- ÊÄßÂà• -->
              <div class="mb-3">
                <label class="form-label fw-bold">ÊÄßÂà• *</label>
                <div class="gender-options">
                  <?php foreach ($genders as $gender): ?>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="gender_id" id="gender<?= $gender['id'] ?>"
                        value="<?= $gender['id'] ?>" required>
                      <label class="form-check-label fw-bold" for="gender<?= $gender['id'] ?>">
                        <?php if ($gender['name'] === 'Áî∑ÊÄß'): ?>
                          <i class="fas fa-mars text-primary me-1"></i>
                        <?php else: ?>
                          <i class="fas fa-venus text-danger me-1"></i>
                        <?php endif; ?>
                        <?= htmlspecialchars($gender['name']) ?>
                      </label>
                    </div>
                  <?php endforeach; ?>
                </div>
              </div>

              <!-- ÊúÉÂì°Á≠âÁ¥ö -->
              <div class="input-group mb-3">
                <span class="input-group-text"><i class="fas fa-crown"></i></span>
                <select class="form-control fw-bold" name="status_id" id="status_id">
                  <?php foreach ($levels as $level): ?>
                    <option value="<?= $level['id'] ?>" <?= $level['id'] == 1 ? 'selected' : '' ?>>
                      <?= htmlspecialchars($level['name']) ?>
                      <?php if ($level['id'] == 1): ?>
                        (È†êË®≠)
                      <?php endif; ?>
                    </option>
                  <?php endforeach; ?>
                </select>
              </div>

              <!-- Â§ßÈ†≠Ë≤º -->
              <div class="mb-4">
                <label class="form-label fw-bold">
                  <i class="fas fa-camera me-1"></i>Â§ßÈ†≠Ë≤º
                </label>
                <div class="upload-area" onclick="document.getElementById('avatar').click()">
                  <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                  <div class="fw-bold text-muted mb-2">ÈªûÊìä‰∏äÂÇ≥È†≠ÂÉè</div>
                  <small class="text-muted">ÊîØÊè¥ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºèÔºåÊ™îÊ°àÂ§ßÂ∞è‰∏çË∂ÖÈÅé 5MB</small>
                </div>
                <input type="file" name="avatar" id="avatar" class="d-none" accept="image/*">

                <!-- ÂúñÁâáÈ†êË¶Ω -->
                <div class="d-flex justify-content-center mt-3">
                  <img id="imagePreview" class="rounded file-preview" alt="È†êË¶ΩÂúñÁâá" style="display: none;">
                </div>
              </div>

              <!-- ÊúçÂãôÊ¢ùÊ¨æ -->
              <div class="mb-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="terms-conditions" name="terms" required />
                  <label class="form-check-label fw-bold" for="terms-conditions">
                    ÊàëÂêåÊÑè
                    <a href="javascript:void(0);" data-bs-toggle="modal" data-bs-target="#termsModal"
                      class="text-primary">ÊúçÂãôÊ¢ùÊ¨æËàáÈö±ÁßÅÊîøÁ≠ñ</a>
                  </label>
                </div>
              </div>

              <!-- Êèê‰∫§ÊåâÈàï -->
              <div class="d-flex gap-3 justify-content-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-user-plus me-1"></i>Âª∫Á´ãÊúÉÂì°Â∏≥Ëôü
                </button>
                <a href="login.php" class="btn btn-outline-success fw-bold">
                  <i class="fas fa-arrow-left me-1"></i>ËøîÂõû
                </a>
              </div>
            </form>

          </div>
        </div>
        <!-- /Register Card -->
      </div>
    </div>
  </div>
  <!-- / Content -->

  <!-- Terms Modal -->
  <div class="modal fade" id="termsModal" tabindex="-1" data-bs-backdrop="true" data-bs-keyboard="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-file-contract me-2"></i>ÊúçÂãôÊ¢ùÊ¨æËàáÈö±ÁßÅÊîøÁ≠ñ
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6 class="text-primary">ÊúçÂãôÊ¢ùÊ¨æ</h6>
          <p>Ê≠°Ëøé‰ΩøÁî®ÂøÉÊ©ãÊóÖÈÅäÊúÉÂì°ÊúçÂãô„ÄÇ‰ΩøÁî®Êú¨ÊúçÂãôÂç≥Ë°®Á§∫ÊÇ®ÂêåÊÑèÈÅµÂÆà‰ª•‰∏ãÊ¢ùÊ¨æÔºö</p>
          <ul class="mb-3">
            <li>ÊÇ®ÂøÖÈ†àÊèê‰æõÁúüÂØ¶„ÄÅÊ∫ñÁ¢∫ÁöÑÂÄã‰∫∫Ë≥áÊñô</li>
            <li>‰∏çÂæó‰ΩøÁî®Êú¨ÊúçÂãôÈÄ≤Ë°å‰ªª‰ΩïÈÅïÊ≥ïÊàñ‰∏çÁï∂Ë°åÁÇ∫</li>
            <li>ÊàëÂÄë‰øùÁïôÈö®ÊôÇ‰øÆÊîπÊúçÂãôÊ¢ùÊ¨æÁöÑÊ¨äÂà©</li>
          </ul>

          <h6 class="text-primary">Èö±ÁßÅÊîøÁ≠ñ</h6>
          <p>ÊàëÂÄëÈáçË¶ñÊÇ®ÁöÑÈö±ÁßÅÊ¨äÔºåÊâøË´æ‰øùË≠∑ÊÇ®ÁöÑÂÄã‰∫∫Ë≥áÊñôÔºö</p>
          <ul class="mb-0">
            <li>ÂÉÖÂ∞áÊÇ®ÁöÑË≥áÊñôÁî®ÊñºÊèê‰æõÊóÖÈÅäÊúçÂãô</li>
            <li>‰∏çÊúÉÊú™Á∂ìÂêåÊÑèÂ∞áË≥áÊñôÊèê‰æõÁµ¶Á¨¨‰∏âÊñπ</li>
            <li>Êé°Áî®ÈÅ©Áï∂ÁöÑÂÆâÂÖ®Êé™ÊñΩ‰øùË≠∑ÊÇ®ÁöÑË≥áÊñô</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="acceptTerms()">
            <i class="fas fa-check me-1"></i>ÊàëÂêåÊÑè
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÈóúÈñâ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JS -->
  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../assets/vendor/libs/popper/popper.js"></script>
  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>

  <!-- Main JS -->
  <script src="../assets/js/main.js"></script>

  <script>
    // Á≠âÂæÖ DOM ÂÆåÂÖ®ËºâÂÖ•ÂæåÂÜçÂü∑Ë°å
    document.addEventListener('DOMContentLoaded', function () {

      // È†êÂÖàÂàùÂßãÂåñ Modal ‰æÜÊèêÂçáÈÄüÂ∫¶
      const termsModalElement = document.getElementById('termsModal');
      let termsModal = null;
      if (termsModalElement) {
        termsModal = new bootstrap.Modal(termsModalElement, {
          backdrop: true,
          keyboard: true,
          focus: true
        });
      }

      // ÂúñÁâá‰∏äÂÇ≥È†êË¶ΩÂäüËÉΩ
      const avatarInput = document.getElementById('avatar');
      const imagePreview = document.getElementById('imagePreview');
      const uploadArea = document.querySelector('.upload-area');

      if (avatarInput && imagePreview && uploadArea) {
        avatarInput.addEventListener('change', function (e) {
          const file = e.target.files[0];

          if (file) {
            // Ê™¢Êü•Ê™îÊ°àÈ°ûÂûã
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!allowedTypes.includes(file.type)) {
              alert('Ë´ãÈÅ∏Êìá JPG„ÄÅPNG Êàñ GIF Ê†ºÂºèÁöÑÂúñÁâá');
              this.value = '';
              return;
            }

            // Ê™¢Êü•Ê™îÊ°àÂ§ßÂ∞è (5MB)
            if (file.size > 5 * 1024 * 1024) {
              alert('ÂúñÁâáÊ™îÊ°à‰∏çËÉΩË∂ÖÈÅé 5MB');
              this.value = '';
              return;
            }

            // È°ØÁ§∫È†êË¶Ω
            const reader = new FileReader();
            reader.onload = function (e) {
              imagePreview.src = e.target.result;
              imagePreview.style.display = 'block';

              // Êõ¥Êñ∞‰∏äÂÇ≥ÂçÄÂüü
              uploadArea.innerHTML = `
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <div class="fw-bold text-success mb-2">ÂúñÁâáÂ∑≤ÈÅ∏Êìá</div>
                <small class="text-muted">ÈªûÊìäÈáçÊñ∞ÈÅ∏ÊìáÂúñÁâá</small>
              `;
            };
            reader.readAsDataURL(file);
          } else {
            imagePreview.style.display = 'none';
            uploadArea.innerHTML = `
              <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
              <div class="fw-bold text-muted mb-2">ÈªûÊìä‰∏äÂÇ≥È†≠ÂÉè</div>
              <small class="text-muted">ÊîØÊè¥ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºèÔºåÊ™îÊ°àÂ§ßÂ∞è‰∏çË∂ÖÈÅé 5MB</small>
            `;
          }
        });
      }
    });

    // ÊúçÂãôÊ¢ùÊ¨æÂêåÊÑèÂäüËÉΩ - ‰ΩøÁî®È†êÂÖàÂàùÂßãÂåñÁöÑ Modal
    function acceptTerms() {
      document.getElementById('terms-conditions').checked = true;
      const termsModal = bootstrap.Modal.getInstance(document.getElementById('termsModal'));
      if (termsModal) {
        termsModal.hide();
      }
    }
  </script>
</body>

</html>